@model IEnumerable<J.Entities.Single>

@{
    ViewBag.Title = "Single";
}
<div style="display:none;" id="tableData">
@foreach (var item in Model) {
    <span >@item.ID,@item.SingleIntNumber,@item.SingleIntEnum,@item.SingleMoney,@item.SingleDatetime,@item.SingleVarchar,@item.SingleLongVarchar,@item.SingleBit,@item.SingleTinyintBool,@item.SingleTinyintEnum,@item.SingleText</span>
}  
</div>
<script type="text/javascript">
    var EID;
    //验证输入的字符数        
    function CheckLength(o) {
        if (o.val().length == 0) {
            o.addClass("ui-state-error"); //为当前错误添加
            $("#" + o.attr("id") + "_notice").css("color", "red");
            $("#" + o.attr("id") + "_notice").html("此项不能为空");
            return false;
        } else {
            //o.removeClass("ui-state-error");
            //$("#" + o.attr("id") + "_notice").html("");
            return true;
        }
    }
    //验证是否为数字
    function CheckNum(o) {
        if (isNaN(o.val())) {
            o.addClass("ui-state-error"); //为当前错误添加
            $("#" + o.attr("id") + "_notice").css("color", "red");
            $("#" + o.attr("id") + "_notice").html("请输入数字");
            return false;
        } else {
            o.removeClass("ui-state-error");
            return true;
        }
    }
    //查看详情
    function Detail(singleIntNumber,singleintEnum,singleMoney,singleDatetime,singleVarchar,
        singleLongVarchar, singleBit, singleTinyintBool, singleTinyintEnum, singleText) {
        $("#DSingleIntNumber").html(singleIntNumber);
        $("#DSingleIntEnum").html(singleintEnum);
        $("#DSingleMoney").html(singleMoney);
        $("#DSingleDatetime").html(singleDatetime);
        $("#DSingleVarchar").html(singleVarchar);
        $("#DSingleLongVarchar").html(singleLongVarchar);
        $("#DSingleBit").html(singleBit);
        $("#DSingleTinyintBool").html(singleTinyintBool);
        $("#DSingleTinyintEnum").html(singleTinyintEnum);
        $("#DSingleText").html(singleText);
        $("#detailSingle").dialog('open');
    }
    //删除数据
    function Delete(id) {        
        if (confirm("确定删除该条数据？")) {
            $.ajax({
                type: "get",
                cache: false,
                url: "@Url.Action("Delete","Single")",
				            data: { id: id },
				            success: function (data) {
				                if (data == "Y") {
				                    window.location.reload();
				                } else if (data == "N") {
				                    alert("删除失败!");
				                }
				            }
            });
        }
    }
    //新增
    function Create() {
        $("#c").find(":text").val("");
        $("#createSingle").dialog('open');

        $("#SingleDatetime").jdatetimepicker({
            datetimeParse: "yyyy-MM-dd"
        });

        $("#SingleBinary").uploadify({
            'multi': false,								//禁止多个同时上传
            'buttonText': "选择并上传文件",				//按钮上的文字
            'fileTypeDesc': '图片文件',					//文件类型描述
            'fileTypeExts': '*.jpg; *.png',			//文件类型后缀
            'swf': '@Url.Content("~/Static/uploadify/uploadify.swf")',
            'uploader': '@Url.Action("UploadFile", "Single")',
            'onUploadSuccess': function (file, data, response) {
                var dataobj = JSON.parse(data);
                //alert("文件名：" + file + "\nState(success或error):" + dataobj.state + "\nmsg(GUID或错误信息):" + dataobj.msg);
                $("#SingleBinary_notice").html(dataobj.msg);
            }
        });
    }
    //编辑
    function Edit(id,singleIntNumber, singleintEnum, singleMoney, singleDatetime, singleVarchar,
        singleLongVarchar, singleBit, singleTinyintBool, singleTinyintEnum, singleText,photoGUID) {
            EID = id;
            $("#ESingleIntNumber").val(singleIntNumber);
            $("#ESingleIntEnum").val(singleintEnum);
            $("#ESingleMoney").val(singleMoney);
            $("#ESingleDatetime").val(singleDatetime);
            $("#ESingleVarchar").val(singleVarchar);
            $("#ESingleLongVarchar").val(singleLongVarchar);
            $("#ESingleBit").val(singleBit);
            $("#ESingleTinyintBool").val(singleTinyintBool);
            $("#ESingleTinyintEnum").val(singleTinyintEnum);
            $("#ESingleText").val(singleText);
            $("#editSingle").dialog('open');

            $("#ESingleDatetime").jdatetimepicker({
                datetimeParse: "yyyy-MM-dd"
            });

            $("#ESingleBinary").uploadify({
                'multi': false,								//禁止多个同时上传
                'buttonText': "选择并上传文件",				//按钮上的文字
                'fileTypeDesc': '图片文件',					//文件类型描述
                'fileTypeExts': '*.jpg; *.png',			//文件类型后缀
                'swf': '@Url.Content("~/Static/uploadify/uploadify.swf")',
            'uploader': '@Url.Action("UploadFile", "Single")',
            'onUploadSuccess': function (file, data, response) {
                var dataobj = JSON.parse(data);
                //alert("文件名：" + file + "\nState(success或error):" + dataobj.state + "\nmsg(GUID或错误信息):" + dataobj.msg);
                $("#ESingleBinary_notice").html(dataobj.msg);
            }
        });
    }
   </script>
<script type="text/javascript">
    $(function () {
        //搜索
        $("#searchContent").jsearch({
            items: [
                { Name: "小数和整数", Id: "txt_double", Type: "double" },
                { Name: "范围小数和整数", Id: "txt_doubleStart", Type: "doubleRange", Brother: [{ Id: "txt_doubleEnd" }] },
                { Name: "两位整数", Id: "txt_int", Type: "int", MaxLength: 2 },
                { Name: "范围整数", Id: "txt_intStart", Type: "intRange", MaxLength: 3, Brother: [{ Id: "txt_intEnd", MaxLength: 4 }] },
                { Name: "单个日期", Id: "txt_Time", Type: "date" },
                { Name: "两个日期", Id: "date_StartTime", Type: "dateRange", Brother: [{ Id: "date_EndTime" }] },
                { Name: "单选按钮", Id: "btn-radio", name: "radio-hobby", Type: "radio", Value: [{ value: "羽毛球", text: "羽毛球" }, { value: "篮球", text: "篮球", selected: true }, { value: "乒乓球", text: "乒乓球" }] },
                 { Name: "多选按钮", Id: "btn-checkbox", name: "checkbox-hobby", Type: "checkbox", Value: [{ value: "羽毛球", text: "羽毛球", selected: true }, { value: "篮球", text: "篮球", selected: true }, { value: "乒乓球", text: "乒乓球" }] },
                { Name: "自定义", Type: "custom", Content: "<input  id='txt_content1' name='text' type='text' >" },
                { Name: "自定义2", Type: "custom", Content: "<input  id='txt_content2' name='text' type='text' >" },
                { Name: "字符串", Id: "txt_Name", Type: "string", MaxLength: 5 },
                { Name: "单选", Id: "txt_State1", Type: "selectSingle", Value: [{ value: 0, text: "全部" }, { value: 1, text: "正常" }, { value: 2, text: "停用", selected: true }] },
                { Name: "多选", Id: "txt_State", Type: "selectMultiple", Value: [{ value: 0, text: "全部" }, { value: 1, text: "正常" }, { value: 2, text: "停用" }] }

            ],
            onSearchButtonClick: function (data) {
                var selectContent = "";
                for (var i in data) {
                    selectContent += "Id为:" + i + "文本的值为:" + data[i] + ";</br>"
                }
                selectContent += "Id为:txt_content1文本的值为:" + $("#txt_content1").val() + ";</br>";
                selectContent += "Id为:txt_content2文本的值为:" + $("#txt_content2").val() + ";</br>";
                $("#showTableSelectContent").html(selectContent);
            }
        });

        var data = [];
        var length = $("#tableData").children("span").length;
        for (var i = 0; i < length; i++) {
            var dataItem = {
                "ID": null,
                "IntNumber": "",
                "IntEnum": "",
                "Money": "",
                "Datetime": "",
                "Varchar": "",
                "LongVarchar": "",
                "Bit": "",
                "TinyintBool": "",
                "TinyintEnum": "",
                "Text": ""
            };
            var array = [];
            var text = "";
            text = $("#tableData").children("span:eq(" + i + ")").text();
            array = text.split(",");
            dataItem["ID"] = array[0];
            dataItem["IntNumber"] = array[1];
            dataItem["IntEnum"] = array[2];
            dataItem["Money"] = array[3];
            dataItem["Datetime"] = array[4];
            dataItem["Varchar"] = array[5];
            dataItem["LongVarchar"] = array[6];
            dataItem["Bit"] = array[7];
            dataItem["TinyintBool"] = array[8];
            dataItem["TinyintEnum"] = array[9];
            dataItem["Text"] = array[10];
            data.push(dataItem);
        }

        $("#MyTable1").jtable({
            tableHeight: '40%', //表高
            tableWidth: '100%', //表宽
            data:data, //数据源
            columns:
                [
                    {
                        head: "ID",				                            //名称
                        context: "#ID",			                            //#ID
                        maxLength: 5,			                                        //文本最大长度，0不限制
                        head_align: "left",                                             //[left], center, right
                        v_align: "top",		                                            //[top], middle, bottom
                        h_align: "left",		                                            //[left], center, right
                        height: "auto",			                                        //150px, 10%
                        width: "auto"			                                        //150px, 10%
                        , sortColumn: "ID"                                                //排序列
                        , sortType: "desc"                                              //排序规则
                    },
                    { head: "IntNumber", context: "#IntNumber", maxLength: 5, head_align: "left", v_align: "top", h_align: "left", height: "auto", width: "auto", sortColumn: "IntNumber", sortType: "asc" },                   
                    { head: "IntEnum", context: "#IntEnum", maxLength: 5, head_align: "left", v_align: "top", h_align: "left", height: "auto", width: "auto", sortColumn: "IntEnum", sortType: "asc" },
                    { head: "Money", context: "#Money", maxLength: 5, head_align: "left", v_align: "top", h_align: "left", height: "auto", width: "auto", sortColumn: "Money", sortType: "desc" },
                    { head: "Datetime", context: "#Datetime", maxLength: 5, head_align: "left", v_align: "top", h_align: "left", height: "auto", width: "auto", sortColumn: "Datetime", sortType: "asc" },
                    { head: "Varchar", context: "#Varchar", maxLength: 5, head_align: "left", v_align: "top", h_align: "left", height: "auto", width: "auto", sortColumn: "Varchar", sortType: "desc" },
                    { head: "LongVarchar", context: "#LongVarchar", maxLength: 5, head_align: "left", v_align: "top", h_align: "left", height: "auto", width: "auto", sortColumn: "LongVarchar", sortType: "asc" },
                    { head: "Bit", context: "#Bit", maxLength: 5, head_align: "left", v_align: "top", h_align: "left", height: "auto", width: "auto", sortColumn: "Bit", sortType: "asc" },
                    { head: "TinyintBool", context: "#TinyintBool", maxLength: 5, head_align: "left", v_align: "top", h_align: "left", height: "auto", width: "auto", sortColumn: "TinyintBool", sortType: "asc" },
                    { head: "TinyintEnum", context: "#TinyintEnum", maxLength: 5, head_align: "left", v_align: "top", h_align: "left", height: "auto", width: "auto", sortColumn: "TinyintEnum", sortType: "asc" },
                    { head: "Text", context: "#Text", maxLength: 5, head_align: "left", v_align: "top", h_align: "left", height: "auto", width: "auto", sortColumn: "Text", sortType: "asc" },
                    {
                        head: "操作", context: "<a href=javascript:Edit()>编辑</a>|" +
                            "<a href="+"javascript:Detail('#IntNumber','#IntEnum','#Money',#Datetime,'#Varchar','#LongVarchar','#Bit','#TinyintBool','#TinyintEnum','#Text')"+">详细</a>|" +
                            "<a href=javascript:Delete(#ID)>删除</a>",
                        maxLength: 5, head_align: "left", v_align: "top", h_align: "left", height: "auto", width: "auto"
                    }
                ]//列名                
            , sortItem: { sortColumn: "Money", sortType: "asc" }
            , onSortChange: function (sortColumn, head, sortType) {
                $("#sort").jsortSelect("option", "sortItem", { sortColumn: sortColumn, sortType: sortType });
            }
        });

        $("#sort").jsortSelect({
            items: [{ sortColumn: "ID", text: "ID" },
                { sortColumn: "IntNumber", text: "IntNumber", sortType: "asc" },
                { sortColumn: "IntEnum", text: "IntEnum", sortType: "asc" },
                { sortColumn: "Money", text: "Money", sortType: "desc" },
                { sortColumn: "Datetime", text: "Datetime", sortType: "asc" },
                { sortColumn: "Varchar", text: "Varchar", sortType: "desc" },
                { sortColumn: "LongVarchar", text: "LongVarchar", sortType: "asc" },
                { sortColumn: "Bit", text: "Bit", sortType: "asc" },
                { sortColumn: "TinyintBool", text: "TinyintBool", sortType: "asc" },
                { sortColumn: "TinyintEnum", text: "TinyintEnum", sortType: "asc" },
                { sortColumn: "Text", text: "Text", sortType: "asc" }
            ],
            onSortChange: function (sortColumn, text, sortType) {

                alert("选择的字段名称为:" + sortColumn + ";显示名称为:" + text + ";排序方式为:" + sortType);

            }

        });
            //新增页面属性
            var SingleIntNumber = $("#SingleIntNumber");
            var SingleIntEnum = $("#SingleIntEnum");
            var SingleMoney = $("#SingleMoney");
            var SingleDatetime = $("#SingleDatetime");
            var SingleVarchar = $("#SingleVarchar");
            var SingleLongVarchar = $("#SingleLongVarchar");
            var SingleBit = $("#SingleBit");
            var SingleTinyintBool = $("#SingleTinyintBool");
            var SingleTinyintEnum = $("#SingleTinyintEnum");
            var SingleText = $("#SingleText");
            

            //编辑页面属性
            var ESingleIntNumber = $("#ESingleIntNumber");//
            var ESingleIntEnum = $("#ESingleIntEnum");//
            var ESingleMoney = $("#ESingleMoney");//
            var ESingleDatetime = $("#ESingleDatetime");
            var ESingleVarchar = $("#ESingleVarchar");
            var ESingleLongVarchar = $("#ESingleLongVarchar");
            var ESingleBit = $("#ESingleBit");
            var ESingleTinyintBool = $("#ESingleTinyintBool");//
            var ESingleTinyintEnum = $("#ESingleTinyintEnum");//
            var ESingleText = $("#ESingleText");

            $("#createSingle").find("input:text").bind({
                mousedown: function () {
                    $(this).removeClass("ui-state-error");
                    $("#" + this.id + "_notice").html("");
                }
            });
            $("#editSingle").find("input:text").bind({
                mousedown: function () {
                    $(this).removeClass("ui-state-error");
                    $("#" + this.id + "_notice").html("");
                }
            });

            //新增
            $("#createSingle").dialog({
                maxHeight: 730,
                maxWidth: 580,
                minHeight: 730,
                minWidth: 580,
                bgiframe: true,
                autoOpen: false,
                modal: true,
                buttons: {
                    '确定': function () {
                        var c = 0;
                        if (!CheckNum(SingleIntNumber) || !CheckNum(SingleIntEnum) || !CheckNum(SingleMoney) || !CheckNum(SingleTinyintBool) || !CheckNum(SingleTinyintEnum)) {
                            c += 1;
                        }
                        var lengthConfirm = true;
                        $("#c").find(":text").each(function () {
                            if (!CheckLength($(this))) {
                                lengthConfirm = false;
                                return;
                            }
                        });
                        if (lengthConfirm && c==0) {
                            $.ajax({
                                type: "get",
                                cache: false,
                                url: "@Url.Action("Create", "Single")",
                                data: {
                                    id:EID,
                                    singleIntNumber: SingleIntNumber.val(),
                                    singleIntEnum: SingleIntEnum.val(),
                                    singleMoney: SingleMoney.val(),
                                    singleDatetime: SingleDatetime.val(),
                                    singleVarchar: SingleVarchar.val(),
                                    singleLongVarchar: SingleLongVarchar.val(),
                                    singleBit: SingleBit.val(),
                                    singleTinyintBool: SingleTinyintBool.val(),
                                    singleTinyintEnum: SingleTinyintEnum.val(),
                                    singleText: SingleText.val(),
                                    photoPath: $("#SingleBinary_notice").html()
                                },
                                success: function (data) {
                                    if (data == "Y") {
                                        window.location.reload();
                                    }
                                     else {
                                        alert("新增失败!")
                                    }
                                }
                            });
                        }
                    }
                    , '取消': function () {
                        $("#c").find(":text").removeClass("ui-state-error");
                        $("#c").find("span").html("");
                        $(this).dialog('close');
                    }
                }
            });

            //#region 详情
            $("#detailSingle").dialog({
                maxHeight: 550,
                maxWidth: 450,
                minHeight: 550,
                minWidth: 450,
                bgiframe: true,
                autoOpen: false,
                modal: true
            });
            //#endregion


            //#region编辑数据
            $("#editSingle").dialog({
                maxHeight: 730,
                maxWidth: 580,
                minHeight: 730,
                minWidth: 580,
                bgiframe: true,
                autoOpen: false,
                modal: true,
                buttons: {
                    '确定': function () {
                        var lengthConfirm = true;
                        $("#e").find(":text").each(function () {
                            if (!CheckLength($(this))) {
                                lengthConfirm = false;
                                return;
                            }
                        });
                        if (lengthConfirm) {
				            $.ajax({
				                type: "get",
				                cache: false,
				                url: "@Url.Action("Edit", "Single")",
				                data: {
				                    id:EID,
				                    singleIntNumber: ESingleIntNumber.val(),
				                    singleIntEnum: ESingleIntEnum.val(),
				                    singleMoney: ESingleMoney.val(),
				                    singleDatetime: ESingleDatetime.val(),
				                    singleVarchar: ESingleVarchar.val(),
				                    singleLongVarchar: ESingleLongVarchar.val(),
				                    singleBit: ESingleBit.val()==true?1:0,
				                    singleTinyintBool: ESingleTinyintBool.val()!=true?1:0,
				                    singleTinyintEnum: ESingleTinyintEnum.val(),
				                    singleText: ESingleText.val(),
				                    photoPath: $("#ESingleBinary_notice").html()
				                },
						        success: function (data) {
						            if (data == "Y") {
						                window.location.reload();
						            } else if (data == "N") {
						                alert("出现异常，编辑失败。")
						            } else {
                                        alert(data)
						            }
						        }
					        });
                        }
				},
			    '取消': function () {
			        $("#e").find(":text").removeClass("ui-state-error");
			        $("#e").find("span").html("");
			        $(this).dialog('close');
			    }
			}
            });
            //#endregion

        });
</script>

<div id="searchContent"></div>

<a style="display:block;float:right;" href="javascript:Create()">创建新数据</a>
<div id="sort"></div>
<br />
<div id="MyTable1"></div>

<div id="detailSingle" title="详细" style="display: none; width: 100%;" class="ui-widget ui-widget-content ui-corner-all">
	@Html.Partial("Details")
</div>
<div id="createSingle" title="新增" style="display: none; width: 100%;" class="ui-widget ui-widget-content ui-corner-all">
	@Html.Partial("Create")
</div>
<div id="editSingle" title="编辑" style="display: none; width: 100%;" class="ui-widget ui-widget-content ui-corner-all">
	@Html.Partial("Edit")
</div>